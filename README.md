# ATLAS_WEAKBEAM_PROCESS
The algorithm is programmed using Matlab 2016a. The folder “NoiseSlope_Based_DBSCAN V1.2” contains the source code of our algorithm. Three demos attached with test data are provided in folders from “Demo1” to “Demo3”. The folder “NoiseSlope_Based_DBSCAN TestVersion” contains our up-to-date modification and the produced results could be different from that produced from the former version. The code of the function “DBSCANslope” was developed on the basis of the classical DBSCAN algorithm and the copyright of the classical DBSCAN codes was reserved by the original developer (M. K. Heris from Yarpiz Team) [1]. We suppose that the users are familiar with the classical DBSCAN algorithm and the data product of ICESat-2/ATLAS, especially the ATL03 data product. 

Input data requirement：
The algorithm generally requires three input data, i.e., the geolocated photons from strong beam data, the geolocated photons from weak beam data, and the signal finding results of the strong beam. It should be noted that the strong beam data and weak beam data should be in the same laser pair of ICESat-2. The input files of the geolocatd photons of strong beam and weak beam data are organized in the same format, which is a matrix. This matrix consists of six column vectors corresponding to the along-track distance (the delta-time × satellite flight speed 7.612km/s), the elevation (“heights/h_ph” in ATL03), the latitude (“heights/lat_ph” in ATL03), the longitude (“heights/lon_ph” in ATL03), the confidence level (“heights/signal_conf_ph” in ATL03’), and the delta_time (“heights/delta_time” in ATL03) [2]. These data should be read from the ATL03 dataset and written into a file in the format of ‘.mat’ (please see the file “data_2th.mat” in the path “Demo2/” as an example). The signal finding results of the strong beam are organized similarly and it requires five column vectors, i.e., the along-track distance, elevation, latitude, longitude, and delta_time (please see the file “DBSCAN_data2_filtered.mat” in the path “Demo2/” as an example). 

Parameters setting:
Several parameters need to be set before running the program. The “acc_distance” and “acc_step” in the main program (DataProcess_main) represent the along-track accumulation length and the moving step of the along-track window, which are used to estimate the background noise rate and along-track slope. The “total_window” represents the vertical length for noise rate estimation and should be set according to the vertical window of the using ATL03 dataset. The “total_window” does not have to be very precise but must not exceed the vertical window of the using dataset. It should be noted that the length of the vertical window in ATL03 varies at different sites and the users should check its value before setting this parameter. The “estimate_max_slope”, “thrshold_window1”, and “threshold_window2” are used to ensure that the signal photon events (PEs) will not be counted in the estimation of noise rate. These five parameters also appear and operate similarly in the function “filter_DBSCAN” and two groups of five parameters are totally independent and the users can adjust them separately.

Operating:
Make sure that the filename of the input data is correctly revised in the Line 14, 22, and 209 in the main program. We have revised the filename and parameters in the three demos, so the users can directly run the main program (DataProcess_main) and wait for the signal extraction results. The signal extraction results can be accessed from the last column of the matrix named “temp_filter_input2” and the value 0 corresponds to noise PE, while the other values correspond to the signal PE. It should be noted that the users are supposed to use code “index_final = find(abs(temp_filter_input2(:,end))>0)” instead of “index_final = find(temp_filter_input2(:,end)>0)” to distinguish the signal PEs, as the flag that marks the signal PE is negative.

Acknowledgement: We thank the NASA NSIDC for distributing the ICESat-2 data and www.yarpiz.com for distributing the MATLAB code of the classical DBSCAN algorithm.

References
[1] Heris, M. K. DBSCAN Clustering in MATLAB https://yarpiz.com/255/ypml110-dbscan-clustering (Yarpiz, 2015).
[2] Neumann, T. A.; Brenner, A.; Hancock, D.; Robbins, J.; Saba, J.; Harbeck, K.; Gibbons, A.; Lee, J.; Luthcke, S. B.; Rebold, T., et al. ATLAS/ICESat-2 L2A Global Geolocated Photon Data, Version 3. Boulder, Colorado USA. NASA National Snow and Ice Data Center Distributed Active Archive Center (2020). https://doi.org/10.5067/ATLAS/ATL03.003.
